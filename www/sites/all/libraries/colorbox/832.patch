From b3bc29a08c7eda421a325cc9ebfeb24ba17f7141 Mon Sep 17 00:00:00 2001
From: James Wilson <jrwilson3@gmail.com>
Date: Tue, 28 Mar 2017 18:35:40 -0400
Subject: [PATCH 1/7] Aria Accessibility compliance. fixes #765

This is a formal approach to fixing #765 with proper use of Aria
attributes as an alternative to PR #821.

Changes include:

*  Add `aria-hidden` attributes on the dialog box and navigational
   buttons.

*  Update the `aria-hidden` value to `true` or `false` at the
   appropriate times.

*  Add `aria-label` attributes to navigational buttons, using the
   colorbox default settings at page load time, and then update the
   value when a colorbox is loaded.

*  Add `aria-labelledby` and `aria-describedby` attributes to the
   div containing `role='dialog'`.
---
 jquery.colorbox.js | 60 ++++++++++++++++++++++++++++++++++++----------
 1 file changed, 47 insertions(+), 13 deletions(-)

diff --git a/jquery.colorbox.js b/jquery.colorbox.js
index a4e2d15..f66f7dd 100644
--- a/jquery.colorbox.js
+++ b/jquery.colorbox.js
@@ -318,6 +318,7 @@
 		function start() {
 			$slideshow
 				.html(settings.get('slideshowStop'))
+				.attr('aria-lable', settings.get('slideshowStop'))
 				.unbind(click)
 				.one(click, stop);
 
@@ -337,6 +338,7 @@
 
 			$slideshow
 				.html(settings.get('slideshowStart'))
+				.attr('aria-lable', settings.get('slideshowStart'))
 				.unbind(click)
 				.one(click, function () {
 					publicMethod.next();
@@ -348,7 +350,7 @@
 
 		function reset() {
 			active = false;
-			$slideshow.hide();
+			$slideshow.attr('aria-hidden', 'true').hide();
 			clear();
 			$events
 				.unbind(event_complete, set)
@@ -371,7 +373,7 @@
 					} else {
 						stop();
 					}
-					$slideshow.show();
+					$slideshow.attr('aria-hidden', 'false').show();
 				}
 			}
 		};
@@ -396,7 +398,7 @@
 				setClass(settings.get('className'));
 
 				// Show colorbox so the sizes can be calculated in older versions of jQuery
-				$box.css({visibility:'hidden', display:'block', opacity:''});
+				$box.css({visibility:'hidden', display:'block', opacity:''}).attr('aria-hidden', 'true');
 
 				$loaded = $tag(div, 'LoadedContent', 'width:0; height:0; overflow:hidden; visibility:hidden');
 				$content.css({width:'', height:''}).append($loaded);
@@ -424,7 +426,7 @@
 
 				$groupControls.add($title).hide();
 
-				$box.focus();
+				$box.attr('aria-hidden', 'false').focus();
 
 				if (settings.get('trapFocus')) {
 					// Confine focus to the modal
@@ -455,7 +457,11 @@
 			}).show();
 
 			if (settings.get('closeButton')) {
-				$close.html(settings.get('close')).appendTo($content);
+				$close
+					.html(settings.get('close'))
+					.attr('aria-label', settings.get('close'))
+					.attr('aria-hidden', 'false')
+					.appendTo($content);
 			} else {
 				$close.appendTo('<div/>'); // replace with .detach() when dropping jQuery < 1.4
 			}
@@ -474,6 +480,9 @@
 				id: colorbox,
 				'class': $.support.opacity === false ? prefix + 'IE' : '', // class for optional IE8 & lower targeted CSS.
 				role: 'dialog',
+				'aria-hidden': 'true',
+				'aria-labelledby': "cboxTitle",
+				'aria-describedby': "cboxCurrent",
 				tabindex: '-1'
 			}).hide();
 			$overlay = $tag(div, "Overlay").hide();
@@ -482,13 +491,29 @@
 			$content = $tag(div, "Content").append(
 				$title = $tag(div, "Title"),
 				$current = $tag(div, "Current"),
-				$prev = $('<button type="button"/>').attr({id:prefix+'Previous'}),
-				$next = $('<button type="button"/>').attr({id:prefix+'Next'}),
-				$slideshow = $('<button type="button"/>').attr({id:prefix+'Slideshow'}),
+				$prev = $('<button type="button"/>').attr({
+					id: prefix+'Previous',
+					'aria-label': 'previous',
+					'aria-hidden': 'true'
+				}),
+				$next = $('<button type="button"/>').attr({
+					id: prefix+'Next',
+					'aria-label': 'next',
+					'aria-hidden': 'true'
+				}),
+				$slideshow = $('<button type="button"/>').attr({
+					id: prefix+'Slideshow',
+					'aria-label': 'start slideshow',
+					'aria-hidden': 'true'
+				}),
 				$loadingOverlay
 			);
 
-			$close = $('<button type="button"/>').attr({id:prefix+'Close'});
+			$close = $('<button type="button"/>').attr({
+				id: prefix+'Close',
+				'aria-label': 'close',
+				'aria-hidden': 'true'
+			});
 
 			$wrap.append( // The 3x3 Grid that makes up Colorbox
 				$tag(div).append(
@@ -678,7 +703,7 @@
 			top += Math.round(Math.max(winheight() - settings.h - loadedHeight - interfaceHeight, 0) / 2);
 		}
 
-		$box.css({top: offset.top, left: offset.left, visibility:'visible'});
+		$box.css({top: offset.top, left: offset.left, visibility:'visible'}).attr('aria-hidden', 'false');
 
 		// this gives the wrapper plenty of breathing room so it's floated contents can move around smoothly,
 		// but it has to be shrank down around the size of div#colorbox when it's done.  If not,
@@ -842,8 +867,17 @@
 					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total)).show();
 				}
 
-				$next[(settings.get('loop') || index < total - 1) ? "show" : "hide"]().html(settings.get('next'));
-				$prev[(settings.get('loop') || index) ? "show" : "hide"]().html(settings.get('previous'));
+				$showNext = (settings.get('loop') || index < total - 1);
+				$next[$showNext ? 'show' : 'hide']()
+					.html(settings.get('next'))
+					.attr('aria-hidden', $showNext ? 'false' : 'true')
+					.attr('aria-label', settings.get('next'));
+
+				$showPrev = (settings.get('loop') || index);
+				$prev[$showPrev ? 'show' : 'hide']()
+					.html(settings.get('previous'))
+					.attr('aria-hidden', $showPrev ? 'false' : 'true')
+					.attr('aria-label', settings.get('previous'));
 
 				slideshow();
 
@@ -1063,7 +1097,7 @@
 			$overlay.fadeTo(settings.get('fadeOut') || 0, 0);
 
 			$box.stop().fadeTo(settings.get('fadeOut') || 0, 0, function () {
-				$box.hide();
+				$box.hide().attr('aria-hidden', 'true');
 				$overlay.hide();
 				trigger(event_purge);
 				$loaded.remove();

From 16dc7165e322edaa306993332a2737ea1f601f8a Mon Sep 17 00:00:00 2001
From: James Wilson <jrwilson3@gmail.com>
Date: Tue, 28 Mar 2017 19:16:58 -0400
Subject: [PATCH 2/7] Pass HTML_CodeSniffer WCAG 2.0 tests

---
 jquery.colorbox.js | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/jquery.colorbox.js b/jquery.colorbox.js
index f66f7dd..d9dd5e9 100644
--- a/jquery.colorbox.js
+++ b/jquery.colorbox.js
@@ -491,17 +491,17 @@
 			$content = $tag(div, "Content").append(
 				$title = $tag(div, "Title"),
 				$current = $tag(div, "Current"),
-				$prev = $('<button type="button"/>').attr({
+				$prev = $('<button type="button">previous</button>').attr({
 					id: prefix+'Previous',
 					'aria-label': 'previous',
 					'aria-hidden': 'true'
 				}),
-				$next = $('<button type="button"/>').attr({
+				$next = $('<button type="button">next</button>').attr({
 					id: prefix+'Next',
 					'aria-label': 'next',
 					'aria-hidden': 'true'
 				}),
-				$slideshow = $('<button type="button"/>').attr({
+				$slideshow = $('<button type="button">start slideshow</button>').attr({
 					id: prefix+'Slideshow',
 					'aria-label': 'start slideshow',
 					'aria-hidden': 'true'
@@ -509,7 +509,7 @@
 				$loadingOverlay
 			);
 
-			$close = $('<button type="button"/>').attr({
+			$close = $('<button type="button">close</button>').attr({
 				id: prefix+'Close',
 				'aria-label': 'close',
 				'aria-hidden': 'true'

From 0acca4fb48e8710d70c6de43c542cc74ccd9585a Mon Sep 17 00:00:00 2001
From:  <bramd@brams-hp.localdomain>
Date: Fri, 2 Jun 2017 15:55:33 +0200
Subject: [PATCH 3/7] Cleanup unneeded aria-labels, fix autoreading of dialog
 by using ARIA live regions and ensure focus is on the first element in the
 dialog when it opens

---
 jquery.colorbox.js | 30 ++++++++++++++++++------------
 1 file changed, 18 insertions(+), 12 deletions(-)

diff --git a/jquery.colorbox.js b/jquery.colorbox.js
index d9dd5e9..a22e2c0 100644
--- a/jquery.colorbox.js
+++ b/jquery.colorbox.js
@@ -426,7 +426,7 @@
 
 				$groupControls.add($title).hide();
 
-				$box.attr('aria-hidden', 'false').focus();
+				$box.attr('aria-hidden', 'false');
 
 				if (settings.get('trapFocus')) {
 					// Confine focus to the modal
@@ -459,7 +459,6 @@
 			if (settings.get('closeButton')) {
 				$close
 					.html(settings.get('close'))
-					.attr('aria-label', settings.get('close'))
 					.attr('aria-hidden', 'false')
 					.appendTo($content);
 			} else {
@@ -489,21 +488,19 @@
 			$loadingOverlay = $([$tag(div, "LoadingOverlay")[0],$tag(div, "LoadingGraphic")[0]]);
 			$wrap = $tag(div, "Wrapper");
 			$content = $tag(div, "Content").append(
-				$title = $tag(div, "Title"),
+				$title = $tag(div, "Title")
+					.attr('aria-live', 'polite'),
 				$current = $tag(div, "Current"),
 				$prev = $('<button type="button">previous</button>').attr({
 					id: prefix+'Previous',
-					'aria-label': 'previous',
 					'aria-hidden': 'true'
 				}),
 				$next = $('<button type="button">next</button>').attr({
 					id: prefix+'Next',
-					'aria-label': 'next',
 					'aria-hidden': 'true'
 				}),
 				$slideshow = $('<button type="button">start slideshow</button>').attr({
 					id: prefix+'Slideshow',
-					'aria-label': 'start slideshow',
 					'aria-hidden': 'true'
 				}),
 				$loadingOverlay
@@ -511,7 +508,6 @@
 
 			$close = $('<button type="button">close</button>').attr({
 				id: prefix+'Close',
-				'aria-label': 'close',
 				'aria-hidden': 'true'
 			});
 
@@ -864,20 +860,30 @@
 
 			if (total > 1) { // handle grouping
 				if (typeof settings.get('current') === "string") {
-					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total)).show();
+					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total))
+						.attr('aria-live', 'polite')
+						.show();
 				}
 
 				$showNext = (settings.get('loop') || index < total - 1);
 				$next[$showNext ? 'show' : 'hide']()
 					.html(settings.get('next'))
-					.attr('aria-hidden', $showNext ? 'false' : 'true')
-					.attr('aria-label', settings.get('next'));
+					.attr('aria-hidden', $showNext ? 'false' : 'true');
 
 				$showPrev = (settings.get('loop') || index);
 				$prev[$showPrev ? 'show' : 'hide']()
 					.html(settings.get('previous'))
-					.attr('aria-hidden', $showPrev ? 'false' : 'true')
-					.attr('aria-label', settings.get('previous'));
+					.attr('aria-hidden', $showPrev ? 'false' : 'true');
+				
+				if (!($prev.is(':focus') || $next.is(':focus') || $close.is(':focus'))) {
+					if ($showPrev) {
+						$prev.focus();
+					} else if ($showNext) {
+						$next.focus();
+					} else {
+						$close.focus();
+					}
+				}
 
 				slideshow();
 

From a2b39f2c8363d8e7f34fd6ce983a0cc49f25cdf7 Mon Sep 17 00:00:00 2001
From: James Wilson <jrwilson3@gmail.com>
Date: Thu, 15 Jun 2017 10:22:05 -0400
Subject: [PATCH 4/7] Fix spelling of 'aria-label'

---
 jquery.colorbox.js | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/jquery.colorbox.js b/jquery.colorbox.js
index d9dd5e9..1262c02 100644
--- a/jquery.colorbox.js
+++ b/jquery.colorbox.js
@@ -318,7 +318,7 @@
 		function start() {
 			$slideshow
 				.html(settings.get('slideshowStop'))
-				.attr('aria-lable', settings.get('slideshowStop'))
+				.attr('aria-label', settings.get('slideshowStop'))
 				.unbind(click)
 				.one(click, stop);
 
@@ -338,7 +338,7 @@
 
 			$slideshow
 				.html(settings.get('slideshowStart'))
-				.attr('aria-lable', settings.get('slideshowStart'))
+				.attr('aria-label', settings.get('slideshowStart'))
 				.unbind(click)
 				.one(click, function () {
 					publicMethod.next();

From f0919a007d95c9dcff946399dff34b988237b198 Mon Sep 17 00:00:00 2001
From: Bram Duvigneau <bram@bramd.nl>
Date: Fri, 2 Jun 2017 15:55:33 +0200
Subject: [PATCH 5/7] Cleanup unneeded aria-labels, fix autoreading of dialog
 by using ARIA live regions and ensure focus is on the first element in the
 dialog when it opens

---
 jquery.colorbox.js | 30 ++++++++++++++++++------------
 1 file changed, 18 insertions(+), 12 deletions(-)

diff --git a/jquery.colorbox.js b/jquery.colorbox.js
index d9dd5e9..a22e2c0 100644
--- a/jquery.colorbox.js
+++ b/jquery.colorbox.js
@@ -426,7 +426,7 @@
 
 				$groupControls.add($title).hide();
 
-				$box.attr('aria-hidden', 'false').focus();
+				$box.attr('aria-hidden', 'false');
 
 				if (settings.get('trapFocus')) {
 					// Confine focus to the modal
@@ -459,7 +459,6 @@
 			if (settings.get('closeButton')) {
 				$close
 					.html(settings.get('close'))
-					.attr('aria-label', settings.get('close'))
 					.attr('aria-hidden', 'false')
 					.appendTo($content);
 			} else {
@@ -489,21 +488,19 @@
 			$loadingOverlay = $([$tag(div, "LoadingOverlay")[0],$tag(div, "LoadingGraphic")[0]]);
 			$wrap = $tag(div, "Wrapper");
 			$content = $tag(div, "Content").append(
-				$title = $tag(div, "Title"),
+				$title = $tag(div, "Title")
+					.attr('aria-live', 'polite'),
 				$current = $tag(div, "Current"),
 				$prev = $('<button type="button">previous</button>').attr({
 					id: prefix+'Previous',
-					'aria-label': 'previous',
 					'aria-hidden': 'true'
 				}),
 				$next = $('<button type="button">next</button>').attr({
 					id: prefix+'Next',
-					'aria-label': 'next',
 					'aria-hidden': 'true'
 				}),
 				$slideshow = $('<button type="button">start slideshow</button>').attr({
 					id: prefix+'Slideshow',
-					'aria-label': 'start slideshow',
 					'aria-hidden': 'true'
 				}),
 				$loadingOverlay
@@ -511,7 +508,6 @@
 
 			$close = $('<button type="button">close</button>').attr({
 				id: prefix+'Close',
-				'aria-label': 'close',
 				'aria-hidden': 'true'
 			});
 
@@ -864,20 +860,30 @@
 
 			if (total > 1) { // handle grouping
 				if (typeof settings.get('current') === "string") {
-					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total)).show();
+					$current.html(settings.get('current').replace('{current}', index + 1).replace('{total}', total))
+						.attr('aria-live', 'polite')
+						.show();
 				}
 
 				$showNext = (settings.get('loop') || index < total - 1);
 				$next[$showNext ? 'show' : 'hide']()
 					.html(settings.get('next'))
-					.attr('aria-hidden', $showNext ? 'false' : 'true')
-					.attr('aria-label', settings.get('next'));
+					.attr('aria-hidden', $showNext ? 'false' : 'true');
 
 				$showPrev = (settings.get('loop') || index);
 				$prev[$showPrev ? 'show' : 'hide']()
 					.html(settings.get('previous'))
-					.attr('aria-hidden', $showPrev ? 'false' : 'true')
-					.attr('aria-label', settings.get('previous'));
+					.attr('aria-hidden', $showPrev ? 'false' : 'true');
+				
+				if (!($prev.is(':focus') || $next.is(':focus') || $close.is(':focus'))) {
+					if ($showPrev) {
+						$prev.focus();
+					} else if ($showNext) {
+						$next.focus();
+					} else {
+						$close.focus();
+					}
+				}
 
 				slideshow();
 

From b0d406a35016dae2161ad3968f36b25c20727c15 Mon Sep 17 00:00:00 2001
From: Bram Duvigneau <bram@bramd.nl>
Date: Tue, 27 Jun 2017 15:12:46 +0200
Subject: [PATCH 6/7] Reworked focus trapping

---
 jquery.colorbox.js | 53 +++++++++++++++++++++++++++-------------------
 1 file changed, 31 insertions(+), 22 deletions(-)

diff --git a/jquery.colorbox.js b/jquery.colorbox.js
index a22e2c0..7954e0b 100644
--- a/jquery.colorbox.js
+++ b/jquery.colorbox.js
@@ -65,7 +65,7 @@
 		xhrError: "This content failed to load.",
 		imgError: "This image failed to load.",
 
-		// accessbility
+		// accessibility
 		returnFocus: true,
 		trapFocus: true,
 
@@ -199,6 +199,19 @@
 	function winheight() {
 		return window.innerHeight ? window.innerHeight : $(window).height();
 	}
+	
+	// Helper to enumerate focusable elements
+	function focusableEls ($e) {
+		return $e.find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]');
+	}
+	
+	function firstFocusableEl($e) {
+		return focusableEls($e).first();
+	}
+	
+	function lastFocusableEl($e) {
+		return focusableEls($e).last();
+	}
 
 	function Settings(element, options) {
 		if (options !== Object(options)) {
@@ -256,13 +269,6 @@
 		return settings.get('retinaUrl') && window.devicePixelRatio > 1 ? url.replace(settings.get('photoRegex'), settings.get('retinaSuffix')) : url;
 	}
 
-	function trapFocus(e) {
-		if ('contains' in $box[0] && !$box[0].contains(e.target) && e.target !== $overlay[0]) {
-			e.stopPropagation();
-			$box.focus();
-		}
-	}
-
 	function setClass(str) {
 		if (setClass.str !== str) {
 			$box.add($overlay).removeClass(setClass.str).addClass(str);
@@ -428,19 +434,6 @@
 
 				$box.attr('aria-hidden', 'false');
 
-				if (settings.get('trapFocus')) {
-					// Confine focus to the modal
-					// Uses event capturing that is not supported in IE8-
-					if (document.addEventListener) {
-
-						document.addEventListener('focus', trapFocus, true);
-
-						$events.one(event_closed, function () {
-							document.removeEventListener('focus', trapFocus, true);
-						});
-					}
-				}
-
 				// Return focus on closing
 				if (settings.get('returnFocus')) {
 					$events.one(event_closed, function () {
@@ -482,7 +475,6 @@
 				'aria-hidden': 'true',
 				'aria-labelledby': "cboxTitle",
 				'aria-describedby': "cboxCurrent",
-				tabindex: '-1'
 			}).hide();
 			$overlay = $tag(div, "Overlay").hide();
 			$loadingOverlay = $([$tag(div, "LoadingOverlay")[0],$tag(div, "LoadingGraphic")[0]]);
@@ -585,6 +577,23 @@
 							$next.click();
 						}
 					}
+					if (open && settings.get('trapFocus') && key === 9) {
+						if ( focusableEls($box).length === 1 ) {
+							e.preventDefault();
+						} else {
+							if ( e.shiftKey ) {
+								if ( document.activeElement === firstFocusableEl($box)[0] ) {
+									e.preventDefault();
+									lastFocusableEl($box).focus();
+								}
+							} else {
+								if ( document.activeElement === lastFocusableEl($box)[0] ) {
+									e.preventDefault();
+									firstFocusableEl($box).focus();
+								}
+							}
+						}
+					}
 				});
 
 				if ($.isFunction($.fn.on)) {

From 066c3dd98f22bf2684c9719f057e939d80718184 Mon Sep 17 00:00:00 2001
From: Bram Duvigneau <bram@bramd.nl>
Date: Tue, 27 Jun 2017 15:22:00 +0200
Subject: [PATCH 7/7] Updated minified version

---
 jquery.colorbox-min.js | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/jquery.colorbox-min.js b/jquery.colorbox-min.js
index b5109a2..422b272 100644
--- a/jquery.colorbox-min.js
+++ b/jquery.colorbox-min.js
@@ -1,6 +1,6 @@
-/*!
-	Colorbox 1.6.4
-	license: MIT
-	http://www.jacklmoore.com/colorbox
-*/
-(function(t,e,i){function n(i,n,o){var r=e.createElement(i);return n&&(r.id=Z+n),o&&(r.style.cssText=o),t(r)}function o(){return i.innerHeight?i.innerHeight:t(i).height()}function r(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var n;return void 0===this.cache[e]&&(n=t(this.el).attr("data-cbox-"+e),void 0!==n?this.cache[e]=n:void 0!==i[e]?this.cache[e]=i[e]:void 0!==X[e]&&(this.cache[e]=X[e])),this.cache[e]},this.get=function(e){var i=this.value(e);return t.isFunction(i)?i.call(this.el,this):i}}function h(t){var e=W.length,i=(A+t)%e;return 0>i?e+i:i}function a(t,e){return Math.round((/%/.test(t)?("x"===e?E.width():o())/100:1)*parseInt(t,10))}function s(t,e){return t.get("photo")||t.get("photoRegex").test(e)}function l(t,e){return t.get("retinaUrl")&&i.devicePixelRatio>1?e.replace(t.get("photoRegex"),t.get("retinaSuffix")):e}function d(t){"contains"in x[0]&&!x[0].contains(t.target)&&t.target!==v[0]&&(t.stopPropagation(),x.focus())}function c(t){c.str!==t&&(x.add(v).removeClass(c.str).addClass(t),c.str=t)}function g(e){A=0,e&&e!==!1&&"nofollow"!==e?(W=t("."+te).filter(function(){var i=t.data(this,Y),n=new r(this,i);return n.get("rel")===e}),A=W.index(_.el),-1===A&&(W=W.add(_.el),A=W.length-1)):W=t(_.el)}function u(i){t(e).trigger(i),ae.triggerHandler(i)}function f(i){var o;if(!G){if(o=t(i).data(Y),_=new r(i,o),g(_.get("rel")),!U){U=$=!0,c(_.get("className")),x.css({visibility:"hidden",display:"block",opacity:""}),I=n(se,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),b.css({width:"",height:""}).append(I),j=T.height()+k.height()+b.outerHeight(!0)-b.height(),D=C.width()+H.width()+b.outerWidth(!0)-b.width(),N=I.outerHeight(!0),z=I.outerWidth(!0);var h=a(_.get("initialWidth"),"x"),s=a(_.get("initialHeight"),"y"),l=_.get("maxWidth"),f=_.get("maxHeight");_.w=Math.max((l!==!1?Math.min(h,a(l,"x")):h)-z-D,0),_.h=Math.max((f!==!1?Math.min(s,a(f,"y")):s)-N-j,0),I.css({width:"",height:_.h}),J.position(),u(ee),_.get("onOpen"),O.add(F).hide(),x.focus(),_.get("trapFocus")&&e.addEventListener&&(e.addEventListener("focus",d,!0),ae.one(re,function(){e.removeEventListener("focus",d,!0)})),_.get("returnFocus")&&ae.one(re,function(){t(_.el).focus()})}var p=parseFloat(_.get("opacity"));v.css({opacity:p===p?p:"",cursor:_.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),_.get("closeButton")?B.html(_.get("close")).appendTo(b):B.appendTo("<div/>"),w()}}function p(){x||(V=!1,E=t(i),x=n(se).attr({id:Y,"class":t.support.opacity===!1?Z+"IE":"",role:"dialog",tabindex:"-1"}).hide(),v=n(se,"Overlay").hide(),L=t([n(se,"LoadingOverlay")[0],n(se,"LoadingGraphic")[0]]),y=n(se,"Wrapper"),b=n(se,"Content").append(F=n(se,"Title"),R=n(se,"Current"),P=t('<button type="button"/>').attr({id:Z+"Previous"}),K=t('<button type="button"/>').attr({id:Z+"Next"}),S=t('<button type="button"/>').attr({id:Z+"Slideshow"}),L),B=t('<button type="button"/>').attr({id:Z+"Close"}),y.append(n(se).append(n(se,"TopLeft"),T=n(se,"TopCenter"),n(se,"TopRight")),n(se,!1,"clear:left").append(C=n(se,"MiddleLeft"),b,H=n(se,"MiddleRight")),n(se,!1,"clear:left").append(n(se,"BottomLeft"),k=n(se,"BottomCenter"),n(se,"BottomRight"))).find("div div").css({"float":"left"}),M=n(se,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),O=K.add(P).add(R).add(S)),e.body&&!x.parent().length&&t(e.body).append(v,x.append(y,M))}function m(){function i(t){t.which>1||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),f(this))}return x?(V||(V=!0,K.click(function(){J.next()}),P.click(function(){J.prev()}),B.click(function(){J.close()}),v.click(function(){_.get("overlayClose")&&J.close()}),t(e).bind("keydown."+Z,function(t){var e=t.keyCode;U&&_.get("escKey")&&27===e&&(t.preventDefault(),J.close()),U&&_.get("arrowKey")&&W[1]&&!t.altKey&&(37===e?(t.preventDefault(),P.click()):39===e&&(t.preventDefault(),K.click()))}),t.isFunction(t.fn.on)?t(e).on("click."+Z,"."+te,i):t("."+te).live("click."+Z,i)),!0):!1}function w(){var e,o,r,h=J.prep,d=++le;if($=!0,q=!1,u(he),u(ie),_.get("onLoad"),_.h=_.get("height")?a(_.get("height"),"y")-N-j:_.get("innerHeight")&&a(_.get("innerHeight"),"y"),_.w=_.get("width")?a(_.get("width"),"x")-z-D:_.get("innerWidth")&&a(_.get("innerWidth"),"x"),_.mw=_.w,_.mh=_.h,_.get("maxWidth")&&(_.mw=a(_.get("maxWidth"),"x")-z-D,_.mw=_.w&&_.w<_.mw?_.w:_.mw),_.get("maxHeight")&&(_.mh=a(_.get("maxHeight"),"y")-N-j,_.mh=_.h&&_.h<_.mh?_.h:_.mh),e=_.get("href"),Q=setTimeout(function(){L.show()},100),_.get("inline")){var c=t(e).eq(0);r=t("<div>").hide().insertBefore(c),ae.one(he,function(){r.replaceWith(c)}),h(c)}else _.get("iframe")?h(" "):_.get("html")?h(_.get("html")):s(_,e)?(e=l(_,e),q=_.get("createImg"),t(q).addClass(Z+"Photo").bind("error."+Z,function(){h(n(se,"Error").html(_.get("imgError")))}).one("load",function(){d===le&&setTimeout(function(){var e;_.get("retinaImage")&&i.devicePixelRatio>1&&(q.height=q.height/i.devicePixelRatio,q.width=q.width/i.devicePixelRatio),_.get("scalePhotos")&&(o=function(){q.height-=q.height*e,q.width-=q.width*e},_.mw&&q.width>_.mw&&(e=(q.width-_.mw)/q.width,o()),_.mh&&q.height>_.mh&&(e=(q.height-_.mh)/q.height,o())),_.h&&(q.style.marginTop=Math.max(_.mh-q.height,0)/2+"px"),W[1]&&(_.get("loop")||W[A+1])&&(q.style.cursor="pointer",t(q).bind("click."+Z,function(){J.next()})),q.style.width=q.width+"px",q.style.height=q.height+"px",h(q)},1)}),q.src=e):e&&M.load(e,_.get("data"),function(e,i){d===le&&h("error"===i?n(se,"Error").html(_.get("xhrError")):t(this).contents())})}var v,x,y,b,T,C,H,k,W,E,I,M,L,F,R,S,K,P,B,O,_,j,D,N,z,A,q,U,$,G,Q,J,V,X={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return t(this).attr("href")},title:function(){return this.title},createImg:function(){var e=new Image,i=t(this).data("cbox-img-attrs");return"object"==typeof i&&t.each(i,function(t,i){e[t]=i}),e},createIframe:function(){var i=e.createElement("iframe"),n=t(this).data("cbox-iframe-attrs");return"object"==typeof n&&t.each(n,function(t,e){i[t]=e}),"frameBorder"in i&&(i.frameBorder=0),"allowTransparency"in i&&(i.allowTransparency="true"),i.name=(new Date).getTime(),i.allowFullscreen=!0,i}},Y="colorbox",Z="cbox",te=Z+"Element",ee=Z+"_open",ie=Z+"_load",ne=Z+"_complete",oe=Z+"_cleanup",re=Z+"_closed",he=Z+"_purge",ae=t("<a/>"),se="div",le=0,de={},ce=function(){function t(){clearTimeout(h)}function e(){(_.get("loop")||W[A+1])&&(t(),h=setTimeout(J.next,_.get("slideshowSpeed")))}function i(){S.html(_.get("slideshowStop")).unbind(s).one(s,n),ae.bind(ne,e).bind(ie,t),x.removeClass(a+"off").addClass(a+"on")}function n(){t(),ae.unbind(ne,e).unbind(ie,t),S.html(_.get("slideshowStart")).unbind(s).one(s,function(){J.next(),i()}),x.removeClass(a+"on").addClass(a+"off")}function o(){r=!1,S.hide(),t(),ae.unbind(ne,e).unbind(ie,t),x.removeClass(a+"off "+a+"on")}var r,h,a=Z+"Slideshow_",s="click."+Z;return function(){r?_.get("slideshow")||(ae.unbind(oe,o),o()):_.get("slideshow")&&W[1]&&(r=!0,ae.one(oe,o),_.get("slideshowAuto")?i():n(),S.show())}}();t[Y]||(t(p),J=t.fn[Y]=t[Y]=function(e,i){var n,o=this;return e=e||{},t.isFunction(o)&&(o=t("<a/>"),e.open=!0),o[0]?(p(),m()&&(i&&(e.onComplete=i),o.each(function(){var i=t.data(this,Y)||{};t.data(this,Y,t.extend(i,e))}).addClass(te),n=new r(o[0],e),n.get("open")&&f(o[0])),o):o},J.position=function(e,i){function n(){T[0].style.width=k[0].style.width=b[0].style.width=parseInt(x[0].style.width,10)-D+"px",b[0].style.height=C[0].style.height=H[0].style.height=parseInt(x[0].style.height,10)-j+"px"}var r,h,s,l=0,d=0,c=x.offset();if(E.unbind("resize."+Z),x.css({top:-9e4,left:-9e4}),h=E.scrollTop(),s=E.scrollLeft(),_.get("fixed")?(c.top-=h,c.left-=s,x.css({position:"fixed"})):(l=h,d=s,x.css({position:"absolute"})),d+=_.get("right")!==!1?Math.max(E.width()-_.w-z-D-a(_.get("right"),"x"),0):_.get("left")!==!1?a(_.get("left"),"x"):Math.round(Math.max(E.width()-_.w-z-D,0)/2),l+=_.get("bottom")!==!1?Math.max(o()-_.h-N-j-a(_.get("bottom"),"y"),0):_.get("top")!==!1?a(_.get("top"),"y"):Math.round(Math.max(o()-_.h-N-j,0)/2),x.css({top:c.top,left:c.left,visibility:"visible"}),y[0].style.width=y[0].style.height="9999px",r={width:_.w+z+D,height:_.h+N+j,top:l,left:d},e){var g=0;t.each(r,function(t){return r[t]!==de[t]?(g=e,void 0):void 0}),e=g}de=r,e||x.css(r),x.dequeue().animate(r,{duration:e||0,complete:function(){n(),$=!1,y[0].style.width=_.w+z+D+"px",y[0].style.height=_.h+N+j+"px",_.get("reposition")&&setTimeout(function(){E.bind("resize."+Z,J.position)},1),t.isFunction(i)&&i()},step:n})},J.resize=function(t){var e;U&&(t=t||{},t.width&&(_.w=a(t.width,"x")-z-D),t.innerWidth&&(_.w=a(t.innerWidth,"x")),I.css({width:_.w}),t.height&&(_.h=a(t.height,"y")-N-j),t.innerHeight&&(_.h=a(t.innerHeight,"y")),t.innerHeight||t.height||(e=I.scrollTop(),I.css({height:"auto"}),_.h=I.height()),I.css({height:_.h}),e&&I.scrollTop(e),J.position("none"===_.get("transition")?0:_.get("speed")))},J.prep=function(i){function o(){return _.w=_.w||I.width(),_.w=_.mw&&_.mw<_.w?_.mw:_.w,_.w}function a(){return _.h=_.h||I.height(),_.h=_.mh&&_.mh<_.h?_.mh:_.h,_.h}if(U){var d,g="none"===_.get("transition")?0:_.get("speed");I.remove(),I=n(se,"LoadedContent").append(i),I.hide().appendTo(M.show()).css({width:o(),overflow:_.get("scrolling")?"auto":"hidden"}).css({height:a()}).prependTo(b),M.hide(),t(q).css({"float":"none"}),c(_.get("className")),d=function(){function i(){t.support.opacity===!1&&x[0].style.removeAttribute("filter")}var n,o,a=W.length;U&&(o=function(){clearTimeout(Q),L.hide(),u(ne),_.get("onComplete")},F.html(_.get("title")).show(),I.show(),a>1?("string"==typeof _.get("current")&&R.html(_.get("current").replace("{current}",A+1).replace("{total}",a)).show(),K[_.get("loop")||a-1>A?"show":"hide"]().html(_.get("next")),P[_.get("loop")||A?"show":"hide"]().html(_.get("previous")),ce(),_.get("preloading")&&t.each([h(-1),h(1)],function(){var i,n=W[this],o=new r(n,t.data(n,Y)),h=o.get("href");h&&s(o,h)&&(h=l(o,h),i=e.createElement("img"),i.src=h)})):O.hide(),_.get("iframe")?(n=_.get("createIframe"),_.get("scrolling")||(n.scrolling="no"),t(n).attr({src:_.get("href"),"class":Z+"Iframe"}).one("load",o).appendTo(I),ae.one(he,function(){n.src="//about:blank"}),_.get("fastIframe")&&t(n).trigger("load")):o(),"fade"===_.get("transition")?x.fadeTo(g,1,i):i())},"fade"===_.get("transition")?x.fadeTo(g,0,function(){J.position(0,d)}):J.position(g,d)}},J.next=function(){!$&&W[1]&&(_.get("loop")||W[A+1])&&(A=h(1),f(W[A]))},J.prev=function(){!$&&W[1]&&(_.get("loop")||A)&&(A=h(-1),f(W[A]))},J.close=function(){U&&!G&&(G=!0,U=!1,u(oe),_.get("onCleanup"),E.unbind("."+Z),v.fadeTo(_.get("fadeOut")||0,0),x.stop().fadeTo(_.get("fadeOut")||0,0,function(){x.hide(),v.hide(),u(he),I.remove(),setTimeout(function(){G=!1,u(re),_.get("onClosed")},1)}))},J.remove=function(){x&&(x.stop(),t[Y].close(),x.stop(!1,!0).remove(),v.remove(),G=!1,x=null,t("."+te).removeData(Y).removeClass(te),t(e).unbind("click."+Z).unbind("keydown."+Z))},J.element=function(){return t(_.el)},J.settings=X)})(jQuery,document,window);
\ No newline at end of file
+/*!
+	Colorbox 1.6.4
+	license: MIT
+	http://www.jacklmoore.com/colorbox
+*/
+(function($,document,window){var defaults={html:false,photo:false,iframe:false,inline:false,transition:"elastic",speed:300,fadeOut:300,width:false,initialWidth:"600",innerWidth:false,maxWidth:false,height:false,initialHeight:"450",innerHeight:false,maxHeight:false,scalePhotos:true,scrolling:true,opacity:.9,preloading:true,className:false,overlayClose:true,escKey:true,arrowKey:true,top:false,bottom:false,left:false,right:false,fixed:false,data:undefined,closeButton:true,fastIframe:true,open:false,reposition:true,loop:true,slideshow:false,slideshowAuto:true,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:false,retinaUrl:false,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:true,trapFocus:true,onOpen:false,onLoad:false,onComplete:false,onCleanup:false,onClosed:false,rel:function(){return this.rel},href:function(){return $(this).attr("href")},title:function(){return this.title},createImg:function(){var img=new Image;var attrs=$(this).data("cbox-img-attrs");if(typeof attrs==="object"){$.each(attrs,function(key,val){img[key]=val})}return img},createIframe:function(){var iframe=document.createElement("iframe");var attrs=$(this).data("cbox-iframe-attrs");if(typeof attrs==="object"){$.each(attrs,function(key,val){iframe[key]=val})}if("frameBorder"in iframe){iframe.frameBorder=0}if("allowTransparency"in iframe){iframe.allowTransparency="true"}iframe.name=(new Date).getTime();iframe.allowFullscreen=true;return iframe}},colorbox="colorbox",prefix="cbox",boxElement=prefix+"Element",event_open=prefix+"_open",event_load=prefix+"_load",event_complete=prefix+"_complete",event_cleanup=prefix+"_cleanup",event_closed=prefix+"_closed",event_purge=prefix+"_purge",$overlay,$box,$wrap,$content,$topBorder,$leftBorder,$rightBorder,$bottomBorder,$related,$window,$loaded,$loadingBay,$loadingOverlay,$title,$current,$slideshow,$next,$prev,$close,$groupControls,$events=$("<a/>"),settings,interfaceHeight,interfaceWidth,loadedHeight,loadedWidth,index,photo,open,active,closing,loadingTimer,publicMethod,div="div",requests=0,previousCSS={},init;function $tag(tag,id,css){var element=document.createElement(tag);if(id){element.id=prefix+id}if(css){element.style.cssText=css}return $(element)}function winheight(){return window.innerHeight?window.innerHeight:$(window).height()}function focusableEls($e){return $e.find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')}function firstFocusableEl($e){return focusableEls($e).first()}function lastFocusableEl($e){return focusableEls($e).last()}function Settings(element,options){if(options!==Object(options)){options={}}this.cache={};this.el=element;this.value=function(key){var dataAttr;if(this.cache[key]===undefined){dataAttr=$(this.el).attr("data-cbox-"+key);if(dataAttr!==undefined){this.cache[key]=dataAttr}else if(options[key]!==undefined){this.cache[key]=options[key]}else if(defaults[key]!==undefined){this.cache[key]=defaults[key]}}return this.cache[key]};this.get=function(key){var value=this.value(key);return $.isFunction(value)?value.call(this.el,this):value}}function getIndex(increment){var max=$related.length,newIndex=(index+increment)%max;return newIndex<0?max+newIndex:newIndex}function setSize(size,dimension){return Math.round((/%/.test(size)?(dimension==="x"?$window.width():winheight())/100:1)*parseInt(size,10))}function isImage(settings,url){return settings.get("photo")||settings.get("photoRegex").test(url)}function retinaUrl(settings,url){return settings.get("retinaUrl")&&window.devicePixelRatio>1?url.replace(settings.get("photoRegex"),settings.get("retinaSuffix")):url}function setClass(str){if(setClass.str!==str){$box.add($overlay).removeClass(setClass.str).addClass(str);setClass.str=str}}function getRelated(rel){index=0;if(rel&&rel!==false&&rel!=="nofollow"){$related=$("."+boxElement).filter(function(){var options=$.data(this,colorbox);var settings=new Settings(this,options);return settings.get("rel")===rel});index=$related.index(settings.el);if(index===-1){$related=$related.add(settings.el);index=$related.length-1}}else{$related=$(settings.el)}}function trigger(event){$(document).trigger(event);$events.triggerHandler(event)}var slideshow=function(){var active,className=prefix+"Slideshow_",click="click."+prefix,timeOut;function clear(){clearTimeout(timeOut)}function set(){if(settings.get("loop")||$related[index+1]){clear();timeOut=setTimeout(publicMethod.next,settings.get("slideshowSpeed"))}}function start(){$slideshow.html(settings.get("slideshowStop")).attr("aria-lable",settings.get("slideshowStop")).unbind(click).one(click,stop);$events.bind(event_complete,set).bind(event_load,clear);$box.removeClass(className+"off").addClass(className+"on")}function stop(){clear();$events.unbind(event_complete,set).unbind(event_load,clear);$slideshow.html(settings.get("slideshowStart")).attr("aria-lable",settings.get("slideshowStart")).unbind(click).one(click,function(){publicMethod.next();start()});$box.removeClass(className+"on").addClass(className+"off")}function reset(){active=false;$slideshow.attr("aria-hidden","true").hide();clear();$events.unbind(event_complete,set).unbind(event_load,clear);$box.removeClass(className+"off "+className+"on")}return function(){if(active){if(!settings.get("slideshow")){$events.unbind(event_cleanup,reset);reset()}}else{if(settings.get("slideshow")&&$related[1]){active=true;$events.one(event_cleanup,reset);if(settings.get("slideshowAuto")){start()}else{stop()}$slideshow.attr("aria-hidden","false").show()}}}}();function launch(element){var options;if(!closing){options=$(element).data(colorbox);settings=new Settings(element,options);getRelated(settings.get("rel"));if(!open){open=active=true;setClass(settings.get("className"));$box.css({visibility:"hidden",display:"block",opacity:""}).attr("aria-hidden","true");$loaded=$tag(div,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden");$content.css({width:"",height:""}).append($loaded);interfaceHeight=$topBorder.height()+$bottomBorder.height()+$content.outerHeight(true)-$content.height();interfaceWidth=$leftBorder.width()+$rightBorder.width()+$content.outerWidth(true)-$content.width();loadedHeight=$loaded.outerHeight(true);loadedWidth=$loaded.outerWidth(true);var initialWidth=setSize(settings.get("initialWidth"),"x");var initialHeight=setSize(settings.get("initialHeight"),"y");var maxWidth=settings.get("maxWidth");var maxHeight=settings.get("maxHeight");settings.w=Math.max((maxWidth!==false?Math.min(initialWidth,setSize(maxWidth,"x")):initialWidth)-loadedWidth-interfaceWidth,0);settings.h=Math.max((maxHeight!==false?Math.min(initialHeight,setSize(maxHeight,"y")):initialHeight)-loadedHeight-interfaceHeight,0);$loaded.css({width:"",height:settings.h});publicMethod.position();trigger(event_open);settings.get("onOpen");$groupControls.add($title).hide();$box.attr("aria-hidden","false");if(settings.get("returnFocus")){$events.one(event_closed,function(){$(settings.el).focus()})}}var opacity=parseFloat(settings.get("opacity"));$overlay.css({opacity:opacity===opacity?opacity:"",cursor:settings.get("overlayClose")?"pointer":"",visibility:"visible"}).show();if(settings.get("closeButton")){$close.html(settings.get("close")).attr("aria-hidden","false").appendTo($content)}else{$close.appendTo("<div/>")}load()}}function appendHTML(){if(!$box){init=false;$window=$(window);$box=$tag(div).attr({id:colorbox,"class":$.support.opacity===false?prefix+"IE":"",role:"dialog","aria-hidden":"true","aria-labelledby":"cboxTitle","aria-describedby":"cboxCurrent"}).hide();$overlay=$tag(div,"Overlay").hide();$loadingOverlay=$([$tag(div,"LoadingOverlay")[0],$tag(div,"LoadingGraphic")[0]]);$wrap=$tag(div,"Wrapper");$content=$tag(div,"Content").append($title=$tag(div,"Title").attr("aria-live","polite"),$current=$tag(div,"Current"),$prev=$('<button type="button">previous</button>').attr({id:prefix+"Previous","aria-hidden":"true"}),$next=$('<button type="button">next</button>').attr({id:prefix+"Next","aria-hidden":"true"}),$slideshow=$('<button type="button">start slideshow</button>').attr({id:prefix+"Slideshow","aria-hidden":"true"}),$loadingOverlay);$close=$('<button type="button">close</button>').attr({id:prefix+"Close","aria-hidden":"true"});$wrap.append($tag(div).append($tag(div,"TopLeft"),$topBorder=$tag(div,"TopCenter"),$tag(div,"TopRight")),$tag(div,false,"clear:left").append($leftBorder=$tag(div,"MiddleLeft"),$content,$rightBorder=$tag(div,"MiddleRight")),$tag(div,false,"clear:left").append($tag(div,"BottomLeft"),$bottomBorder=$tag(div,"BottomCenter"),$tag(div,"BottomRight"))).find("div div").css({"float":"left"});$loadingBay=$tag(div,false,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;");$groupControls=$next.add($prev).add($current).add($slideshow)}if(document.body&&!$box.parent().length){$(document.body).append($overlay,$box.append($wrap,$loadingBay))}}function addBindings(){function clickHandler(e){if(!(e.which>1||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey)){e.preventDefault();launch(this)}}if($box){if(!init){init=true;$next.click(function(){publicMethod.next()});$prev.click(function(){publicMethod.prev()});$close.click(function(){publicMethod.close()});$overlay.click(function(){if(settings.get("overlayClose")){publicMethod.close()}});$(document).bind("keydown."+prefix,function(e){var key=e.keyCode;if(open&&settings.get("escKey")&&key===27){e.preventDefault();publicMethod.close()}if(open&&settings.get("arrowKey")&&$related[1]&&!e.altKey){if(key===37){e.preventDefault();$prev.click()}else if(key===39){e.preventDefault();$next.click()}}if(open&&settings.get("trapFocus")&&key===9){if(focusableEls($box).length===1){e.preventDefault()}else{if(e.shiftKey){if(document.activeElement===firstFocusableEl($box)[0]){e.preventDefault();lastFocusableEl($box).focus()}}else{if(document.activeElement===lastFocusableEl($box)[0]){e.preventDefault();firstFocusableEl($box).focus()}}}}});if($.isFunction($.fn.on)){$(document).on("click."+prefix,"."+boxElement,clickHandler)}else{$("."+boxElement).live("click."+prefix,clickHandler)}}return true}return false}if($[colorbox]){return}$(appendHTML);publicMethod=$.fn[colorbox]=$[colorbox]=function(options,callback){var settings;var $obj=this;options=options||{};if($.isFunction($obj)){$obj=$("<a/>");options.open=true}if(!$obj[0]){return $obj}appendHTML();if(addBindings()){if(callback){options.onComplete=callback}$obj.each(function(){var old=$.data(this,colorbox)||{};$.data(this,colorbox,$.extend(old,options))}).addClass(boxElement);settings=new Settings($obj[0],options);if(settings.get("open")){launch($obj[0])}}return $obj};publicMethod.position=function(speed,loadedCallback){var css,top=0,left=0,offset=$box.offset(),scrollTop,scrollLeft;$window.unbind("resize."+prefix);$box.css({top:-9e4,left:-9e4});scrollTop=$window.scrollTop();scrollLeft=$window.scrollLeft();if(settings.get("fixed")){offset.top-=scrollTop;offset.left-=scrollLeft;$box.css({position:"fixed"})}else{top=scrollTop;left=scrollLeft;$box.css({position:"absolute"})}if(settings.get("right")!==false){left+=Math.max($window.width()-settings.w-loadedWidth-interfaceWidth-setSize(settings.get("right"),"x"),0)}else if(settings.get("left")!==false){left+=setSize(settings.get("left"),"x")}else{left+=Math.round(Math.max($window.width()-settings.w-loadedWidth-interfaceWidth,0)/2)}if(settings.get("bottom")!==false){top+=Math.max(winheight()-settings.h-loadedHeight-interfaceHeight-setSize(settings.get("bottom"),"y"),0)}else if(settings.get("top")!==false){top+=setSize(settings.get("top"),"y")}else{top+=Math.round(Math.max(winheight()-settings.h-loadedHeight-interfaceHeight,0)/2)}$box.css({top:offset.top,left:offset.left,visibility:"visible"}).attr("aria-hidden","false");$wrap[0].style.width=$wrap[0].style.height="9999px";function modalDimensions(){$topBorder[0].style.width=$bottomBorder[0].style.width=$content[0].style.width=parseInt($box[0].style.width,10)-interfaceWidth+"px";$content[0].style.height=$leftBorder[0].style.height=$rightBorder[0].style.height=parseInt($box[0].style.height,10)-interfaceHeight+"px"}css={width:settings.w+loadedWidth+interfaceWidth,height:settings.h+loadedHeight+interfaceHeight,top:top,left:left};if(speed){var tempSpeed=0;$.each(css,function(i){if(css[i]!==previousCSS[i]){tempSpeed=speed;return}});speed=tempSpeed}previousCSS=css;if(!speed){$box.css(css)}$box.dequeue().animate(css,{duration:speed||0,complete:function(){modalDimensions();active=false;$wrap[0].style.width=settings.w+loadedWidth+interfaceWidth+"px";$wrap[0].style.height=settings.h+loadedHeight+interfaceHeight+"px";if(settings.get("reposition")){setTimeout(function(){$window.bind("resize."+prefix,publicMethod.position)},1)}if($.isFunction(loadedCallback)){loadedCallback()}},step:modalDimensions})};publicMethod.resize=function(options){var scrolltop;if(open){options=options||{};if(options.width){settings.w=setSize(options.width,"x")-loadedWidth-interfaceWidth}if(options.innerWidth){settings.w=setSize(options.innerWidth,"x")}$loaded.css({width:settings.w});if(options.height){settings.h=setSize(options.height,"y")-loadedHeight-interfaceHeight}if(options.innerHeight){settings.h=setSize(options.innerHeight,"y")}if(!options.innerHeight&&!options.height){scrolltop=$loaded.scrollTop();$loaded.css({height:"auto"});settings.h=$loaded.height()}$loaded.css({height:settings.h});if(scrolltop){$loaded.scrollTop(scrolltop)}publicMethod.position(settings.get("transition")==="none"?0:settings.get("speed"))}};publicMethod.prep=function(object){if(!open){return}var callback,speed=settings.get("transition")==="none"?0:settings.get("speed");$loaded.remove();$loaded=$tag(div,"LoadedContent").append(object);function getWidth(){settings.w=settings.w||$loaded.width();settings.w=settings.mw&&settings.mw<settings.w?settings.mw:settings.w;return settings.w}function getHeight(){settings.h=settings.h||$loaded.height();settings.h=settings.mh&&settings.mh<settings.h?settings.mh:settings.h;return settings.h}$loaded.hide().appendTo($loadingBay.show()).css({width:getWidth(),overflow:settings.get("scrolling")?"auto":"hidden"}).css({height:getHeight()}).prependTo($content);$loadingBay.hide();$(photo).css({"float":"none"});setClass(settings.get("className"));callback=function(){var total=$related.length,iframe,complete;if(!open){return}function removeFilter(){if($.support.opacity===false){$box[0].style.removeAttribute("filter")}}complete=function(){clearTimeout(loadingTimer);$loadingOverlay.hide();trigger(event_complete);settings.get("onComplete")};$title.html(settings.get("title")).show();$loaded.show();if(total>1){if(typeof settings.get("current")==="string"){$current.html(settings.get("current").replace("{current}",index+1).replace("{total}",total)).attr("aria-live","polite").show()}$showNext=settings.get("loop")||index<total-1;$next[$showNext?"show":"hide"]().html(settings.get("next")).attr("aria-hidden",$showNext?"false":"true");$showPrev=settings.get("loop")||index;$prev[$showPrev?"show":"hide"]().html(settings.get("previous")).attr("aria-hidden",$showPrev?"false":"true");if(!($prev.is(":focus")||$next.is(":focus")||$close.is(":focus"))){if($showPrev){$prev.focus()}else if($showNext){$next.focus()}else{$close.focus()}}slideshow();if(settings.get("preloading")){$.each([getIndex(-1),getIndex(1)],function(){var img,i=$related[this],settings=new Settings(i,$.data(i,colorbox)),src=settings.get("href");if(src&&isImage(settings,src)){src=retinaUrl(settings,src);img=document.createElement("img");img.src=src}})}}else{$groupControls.hide()}if(settings.get("iframe")){iframe=settings.get("createIframe");if(!settings.get("scrolling")){iframe.scrolling="no"}$(iframe).attr({src:settings.get("href"),"class":prefix+"Iframe"}).one("load",complete).appendTo($loaded);$events.one(event_purge,function(){iframe.src="//about:blank"});if(settings.get("fastIframe")){$(iframe).trigger("load")}}else{complete()}if(settings.get("transition")==="fade"){$box.fadeTo(speed,1,removeFilter)}else{removeFilter()}};if(settings.get("transition")==="fade"){$box.fadeTo(speed,0,function(){publicMethod.position(0,callback)})}else{publicMethod.position(speed,callback)}};function load(){var href,setResize,prep=publicMethod.prep,$inline,request=++requests;active=true;photo=false;trigger(event_purge);trigger(event_load);settings.get("onLoad");settings.h=settings.get("height")?setSize(settings.get("height"),"y")-loadedHeight-interfaceHeight:settings.get("innerHeight")&&setSize(settings.get("innerHeight"),"y");settings.w=settings.get("width")?setSize(settings.get("width"),"x")-loadedWidth-interfaceWidth:settings.get("innerWidth")&&setSize(settings.get("innerWidth"),"x");settings.mw=settings.w;settings.mh=settings.h;if(settings.get("maxWidth")){settings.mw=setSize(settings.get("maxWidth"),"x")-loadedWidth-interfaceWidth;settings.mw=settings.w&&settings.w<settings.mw?settings.w:settings.mw}if(settings.get("maxHeight")){settings.mh=setSize(settings.get("maxHeight"),"y")-loadedHeight-interfaceHeight;settings.mh=settings.h&&settings.h<settings.mh?settings.h:settings.mh}href=settings.get("href");loadingTimer=setTimeout(function(){$loadingOverlay.show()},100);if(settings.get("inline")){var $target=$(href).eq(0);$inline=$("<div>").hide().insertBefore($target);$events.one(event_purge,function(){$inline.replaceWith($target)});prep($target)}else if(settings.get("iframe")){prep(" ")}else if(settings.get("html")){prep(settings.get("html"))}else if(isImage(settings,href)){href=retinaUrl(settings,href);photo=settings.get("createImg");$(photo).addClass(prefix+"Photo").bind("error."+prefix,function(){prep($tag(div,"Error").html(settings.get("imgError")))}).one("load",function(){if(request!==requests){return}setTimeout(function(){var percent;if(settings.get("retinaImage")&&window.devicePixelRatio>1){photo.height=photo.height/window.devicePixelRatio;photo.width=photo.width/window.devicePixelRatio}if(settings.get("scalePhotos")){setResize=function(){photo.height-=photo.height*percent;photo.width-=photo.width*percent};if(settings.mw&&photo.width>settings.mw){percent=(photo.width-settings.mw)/photo.width;setResize()}if(settings.mh&&photo.height>settings.mh){percent=(photo.height-settings.mh)/photo.height;setResize()}}if(settings.h){photo.style.marginTop=Math.max(settings.mh-photo.height,0)/2+"px"}if($related[1]&&(settings.get("loop")||$related[index+1])){photo.style.cursor="pointer";$(photo).bind("click."+prefix,function(){publicMethod.next()})}photo.style.width=photo.width+"px";photo.style.height=photo.height+"px";prep(photo)},1)});photo.src=href}else if(href){$loadingBay.load(href,settings.get("data"),function(data,status){if(request===requests){prep(status==="error"?$tag(div,"Error").html(settings.get("xhrError")):$(this).contents())}})}}publicMethod.next=function(){if(!active&&$related[1]&&(settings.get("loop")||$related[index+1])){index=getIndex(1);launch($related[index])}};publicMethod.prev=function(){if(!active&&$related[1]&&(settings.get("loop")||index)){index=getIndex(-1);launch($related[index])}};publicMethod.close=function(){if(open&&!closing){closing=true;open=false;trigger(event_cleanup);settings.get("onCleanup");$window.unbind("."+prefix);$overlay.fadeTo(settings.get("fadeOut")||0,0);$box.stop().fadeTo(settings.get("fadeOut")||0,0,function(){$box.hide().attr("aria-hidden","true");$overlay.hide();trigger(event_purge);$loaded.remove();setTimeout(function(){closing=false;trigger(event_closed);settings.get("onClosed")},1)})}};publicMethod.remove=function(){if(!$box){return}$box.stop();$[colorbox].close();$box.stop(false,true).remove();$overlay.remove();closing=false;$box=null;$("."+boxElement).removeData(colorbox).removeClass(boxElement);$(document).unbind("click."+prefix).unbind("keydown."+prefix)};publicMethod.element=function(){return $(settings.el)};publicMethod.settings=defaults})(jQuery,document,window);
\ No newline at end of file
